{"version":3,"file":"view.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAK,OAAOA,OAAO,KAAK,WAAW,EAAG;EACrC;EACAC,QAAQ,CAACC,gBAAgB,CAAE,kBAAkB,EAAE,MAAM;IACpD;IACA,IAAK,OAAOF,OAAO,KAAK,WAAW,EAAG;MACrC;MACAA,OAAO,CAACG,UAAU,CAAE;QAAEC,WAAW,EAAE;MAAM,CAAE,CAAC;MAE5C,MAAMC,aAAa,GAAGJ,QAAQ,CAACK,gBAAgB,CAC9C,gDACD,CAAC;MAEDD,aAAa,CAACE,OAAO,CAAE,OAAQC,KAAK,EAAEC,KAAK,KAAM;QAChD;QACA,MAAMC,IAAI,GAAGF,KAAK,CAACG,YAAY,CAAE,cAAe,CAAC;;QAEjD;QACA,MAAMC,QAAQ,GAAG,mBAAoBH,KAAK,GAAG,CAAC,EAAG;;QAEjD;QACA,IAAK,CAAED,KAAK,CAACK,YAAY,CAAE,IAAK,CAAC,EAAG;UACnCL,KAAK,CAACM,YAAY,CAAE,IAAI,EAAEF,QAAS,CAAC;QACrC;;QAEA;QACA,IAAIG,eAAe,GAClBP,KAAK,CAACQ,aAAa,CAAE,oBAAqB,CAAC;QAC5C,IAAK,CAAED,eAAe,EAAG;UACxBA,eAAe,GAAGd,QAAQ,CAACgB,aAAa,CAAE,KAAM,CAAC;UACjDF,eAAe,CAACG,SAAS,GAAG,mBAAmB;UAC/CH,eAAe,CAACI,EAAE,GAAG,gBAAiBV,KAAK,EAAG;QAC/C;QAEA,IAAI;UACH;UACA;UACA,MAAM;YAAEW,GAAG;YAAEC;UAAc,CAAC,GAAG,MAAMrB,OAAO,CAACsB,MAAM,CAClD,SAAS,GAAGb,KAAK,EACjBC,IACD,CAAC;;UAED;UACAK,eAAe,CAACQ,SAAS,GAAGH,GAAG;;UAE/B;UACAC,aAAa,GAAIN,eAAgB,CAAC;UAElCP,KAAK,CAACe,SAAS,GAAGH,GAAG;QACtB,CAAC,CAAC,OAAQI,KAAK,EAAG;UACjB;UACA;UACAC,OAAO,CAACD,KAAK,CAAE,2BAA2B,EAAEA,KAAM,CAAC;UACnDT,eAAe,CAACQ,SAAS,GACxB,qDAAqD;QACvD;MACD,CAAE,CAAC;IACJ,CAAC,MAAM;MACN;MACAE,OAAO,CAACC,IAAI,CACX,2EACD,CAAC;IACF;EACD,CAAE,CAAC;AACJ,CAAC,MAAM;EACN;EACA;EACAD,OAAO,CAACC,IAAI,CACX,2EACD,CAAC;AACF,C","sources":["webpack://mermaid-blocks/./src/view.js"],"sourcesContent":["/**\n * This file contains JavaScript code to render MermaidJS diagrams dynamically\n * on the front end of posts or pages containing this block.\n *\n * When this file is specified as the value of the `viewScript` property in\n * `block.json`, it will be enqueued automatically on the front end.\n *\n * Example:\n * {\n *   \"viewScript\": \"file:./view.js\"\n * }\n *\n * @see https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#view-script\n */\n\n// Check if the MermaidJS library is available globally\nif ( typeof mermaid !== 'undefined' ) {\n\t// Wait for the DOM to load\n\tdocument.addEventListener( 'DOMContentLoaded', () => {\n\t\t// Initialize Mermaid globally\n\t\tif ( typeof mermaid !== 'undefined' ) {\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tmermaid.initialize( { startOnLoad: false } );\n\n\t\t\tconst mermaidBlocks = document.querySelectorAll(\n\t\t\t\t'.wp-block-mermaid-blocks-diagram[data-mermaid]'\n\t\t\t);\n\n\t\t\tmermaidBlocks.forEach( async ( block, index ) => {\n\t\t\t\t// Get the MermaidJS code from the `data-mermaid` attribute\n\t\t\t\tconst code = block.getAttribute( 'data-mermaid' );\n\n\t\t\t\t// Generate a unique ID for rendering\n\t\t\t\tconst renderId = `mermaid-diagram-${ index + 1 }`;\n\n\t\t\t\t// Set or update the block's `id` attribute\n\t\t\t\tif ( ! block.hasAttribute( 'id' ) ) {\n\t\t\t\t\tblock.setAttribute( 'id', renderId );\n\t\t\t\t}\n\n\t\t\t\t// Clear the block's content and prepare for rendering\n\t\t\t\tlet renderContainer =\n\t\t\t\t\tblock.querySelector( '.mermaid-container' );\n\t\t\t\tif ( ! renderContainer ) {\n\t\t\t\t\trenderContainer = document.createElement( 'div' );\n\t\t\t\t\trenderContainer.className = 'mermaid-container';\n\t\t\t\t\trenderContainer.id = `diagram-body-${ index }`;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\t// Render the Mermaid diagram\n\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\tconst { svg, bindFunctions } = await mermaid.render(\n\t\t\t\t\t\t'render-' + index,\n\t\t\t\t\t\tcode\n\t\t\t\t\t);\n\n\t\t\t\t\t// Inject the rendered SVG into the container\n\t\t\t\t\trenderContainer.innerHTML = svg;\n\n\t\t\t\t\t// Bind interactivity functions if present\n\t\t\t\t\tbindFunctions?.( renderContainer );\n\n\t\t\t\t\tblock.innerHTML = svg;\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\t// Log errors and display a fallback message\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error( 'Mermaid rendering failed:', error );\n\t\t\t\t\trenderContainer.innerHTML =\n\t\t\t\t\t\t'<p>Mermaid rendering failed. Check your syntax.</p>';\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn(\n\t\t\t\t'Mermaid.js library is not available. Mermaid blocks will not be rendered.'\n\t\t\t);\n\t\t}\n\t} );\n} else {\n\t// Log a warning if Mermaid.js is not loaded\n\t// eslint-disable-next-line no-console\n\tconsole.warn(\n\t\t'Mermaid.js library is not available. Mermaid blocks will not be rendered.'\n\t);\n}\n"],"names":["mermaid","document","addEventListener","initialize","startOnLoad","mermaidBlocks","querySelectorAll","forEach","block","index","code","getAttribute","renderId","hasAttribute","setAttribute","renderContainer","querySelector","createElement","className","id","svg","bindFunctions","render","innerHTML","error","console","warn"],"sourceRoot":""}